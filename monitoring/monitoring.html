<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AWOL & Late Monitoring System</title>
<style>
body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: url(image/515493740_1920941848746823_3957532006161484308_n.jpg);
    margin: 0;
    padding: 0;
}
h1 { text-align: center; color: #343a40; margin-top: 20px; }
.container {
    max-width: 1000px;
    margin: 20px auto;
    padding: 20px;
    background: rgba(255, 255, 255, 0.95);
    border-radius: 10px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
}
form { display: flex; flex-wrap: wrap; gap: 20px; margin-bottom: 20px; }
form input, form select { flex: 1; padding: 10px; border-radius: 5px; border: 1px solid #ced4da; }
form button { padding: 10px 20px; background-color: #007bff; color: #fff; border: none; border-radius: 5px; cursor: pointer; transition: 0.3s; }
form button:hover { background-color: #0056b3; }
table { width: 100%; border-collapse: collapse; margin-top: 10px; }
th, td { border: 1px solid #dee2e6; padding: 12px; text-align: center; }
th { background-color: #007bff; color: #fff; }
tr.present { background-color: #d4edda; }
tr.late { background-color: #fff3cd; }
tr.awol { background-color: #f8d7da; }
td button { padding: 5px 10px; margin: 0 2px; border: none; border-radius: 4px; cursor: pointer; }
td button.edit, td button.editTemp { background-color: #ffc107; color: #212529; }
td button.delete, td button.deleteTemp { background-color: #dc3545; color: #fff; }
#downloadImage, #viewDataBtn { margin-top: 20px; padding:10px 20px; background:#28a745; color:white; border:none; border-radius:5px; cursor:pointer; }
#downloadImage:hover, #viewDataBtn:hover { background:#218838; }
.modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.5); }
.modal-content { background-color: #fff; margin: 5% auto; padding: 20px; border-radius: 10px; width: 90%; max-width: 900px; box-shadow: 0 4px 12px rgba(0,0,0,0.2); }
.close-btn { color: #333; float: right; font-size: 28px; font-weight: bold; cursor: pointer; }
.close-btn:hover { color: #007bff; }
#savedDataTable { width: 100%; border-collapse: collapse; margin-top: 10px; }
#savedDataTable th, #savedDataTable td { border: 1px solid #dee2e6; padding: 10px; text-align: center; }
#savedDataTable th { background-color: #007bff; color: #fff; }
#savedDataTable tr.present { background-color: #d4edda; }
#savedDataTable tr.late { background-color: #fff3cd; }
#savedDataTable tr.awol { background-color: #f8d7da; }
#savedDataModal button { margin: 5px; }
.stats { display: flex; justify-content: space-around; margin-top: 20px; }
.stat-box { padding: 10px 20px; border-radius: 8px; background-color: #e9ecef; text-align: center; width: 30%; }
.stat-box h3 { margin: 5px 0; }
</style>
</head>
<body>

<h1>AWOL & Late Monitoring System</h1>

<div class="container">
    <form id="attendanceForm">
        <input type="text" id="employeeName" placeholder="Employee Name" required>
        <select id="status" required>
            <option value="">--Select Status--</option>
            <option value="Present">Present</option>
            <option value="Late">Late</option>
            <option value="AWOL">AWOL</option>
        </select>
        <input type="date" id="date" required>
        <input type="text" id="comment" placeholder="Comment / Note (Optional)">
        <button type="submit">Add Record</button>
    </form>

    <!-- Table & Stats wrapper for image download -->
    <div id="tableWrapper" style="background:white; padding:20px; border-radius:10px;">
        <h2>AWOL & Late Monitoring Report</h2>
        <table id="attendanceTable">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Status</th>
                    <th>Date</th>
                    <th>Comment</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>

        <!-- Stats included in the image -->
        <div class="stats">
            <div class="stat-box">Total Present: <h3 id="totalPresent">0</h3></div>
            <div class="stat-box">Total Late: <h3 id="totalLate">0</h3></div>
            <div class="stat-box">Total AWOL: <h3 id="totalAWOL">0</h3></div>
        </div>

        <p style="text-align:right; margin-top:10px; font-style:italic;">Prepared by TL Fredie Telebangco</p>
    </div>

    <button id="downloadImage">Download Table as Image</button>
    <button id="viewDataBtn">Delete Saved Data</button>
</div>

<!-- Modal for saved data -->
<div id="savedDataModal" class="modal">
    <div class="modal-content">
        <span class="close-btn">&times;</span>
        <h2>Saved Attendance Records</h2>
        <button id="clearAllData" style="background:#dc3545; color:white; padding:5px 10px; border:none; border-radius:5px; cursor:pointer;">Clear All Saved Data</button>
        <table id="savedDataTable">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Status</th>
                    <th>Date</th>
                    <th>Comment</th>
                    <th>Delete</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script>
// Elements
const form = document.getElementById('attendanceForm');
const tableBody = document.querySelector('#attendanceTable tbody');
const tableWrapper = document.getElementById('tableWrapper');
const downloadBtn = document.getElementById('downloadImage');
const viewDataBtn = document.getElementById('viewDataBtn');
const modal = document.getElementById('savedDataModal');
const modalClose = document.querySelector('.close-btn');
const modalTableBody = document.querySelector('#savedDataTable tbody');
const clearAllBtn = document.getElementById('clearAllData');

let records = JSON.parse(localStorage.getItem('attendanceRecords')) || [];

// Render table from saved records
function renderTable(){
    tableBody.innerHTML = '';
    records.forEach((record,index)=>{
        const row=document.createElement('tr');
        row.className=record.status.toLowerCase();
        row.innerHTML=`
            <td>${record.name}</td>
            <td>${record.status}</td>
            <td>${record.date}</td>
            <td>${record.comment || ''}</td>
            <td>
                <button class="edit" onclick="editRecord(${index})">Edit</button>
                <button class="delete" onclick="deleteRecord(${index})">Delete</button>
            </td>`;
        tableBody.appendChild(row);
    });
    updateStats();
}

// Update stats for visible table
function updateStats(){
    const tempRows = tableBody.querySelectorAll('tr');
    let present=0, late=0, awol=0;
    tempRows.forEach(r=>{
        const status=r.children[1].textContent;
        if(status==="Present") present++;
        else if(status==="Late") late++;
        else if(status==="AWOL") awol++;
    });
    document.getElementById('totalPresent').textContent=present;
    document.getElementById('totalLate').textContent=late;
    document.getElementById('totalAWOL').textContent=awol;
}

// Add new temporary record (does not save)
form.addEventListener('submit', e=>{
    e.preventDefault();
    const name=document.getElementById('employeeName').value;
    const status=document.getElementById('status').value;
    const date=document.getElementById('date').value;
    const comment=document.getElementById('comment').value;

    const row=document.createElement('tr');
    row.className=status.toLowerCase();
    row.innerHTML=`
        <td>${name}</td>
        <td>${status}</td>
        <td>${date}</td>
        <td>${comment || ''}</td>
        <td>
            <button class="editTemp">Edit</button>
            <button class="deleteTemp">Delete</button>
        </td>`;
    tableBody.appendChild(row);
    updateStats();

    row.querySelector('.deleteTemp').addEventListener('click', ()=>{
        row.remove();
        updateStats();
    });
    row.querySelector('.editTemp').addEventListener('click', ()=>{
        document.getElementById('employeeName').value=name;
        document.getElementById('status').value=status;
        document.getElementById('date').value=date;
        document.getElementById('comment').value=comment;
        row.remove();
        updateStats();
    });

    form.reset();
});

// Edit/Delete saved records
function editRecord(index){
    const record=records[index];
    document.getElementById('employeeName').value=record.name;
    document.getElementById('status').value=record.status;
    document.getElementById('date').value=record.date;
    document.getElementById('comment').value=record.comment||'';
}
function deleteRecord(index){
    if(confirm("Delete this saved record?")){
        records.splice(index,1);
        localStorage.setItem('attendanceRecords',JSON.stringify(records));
        renderTable();
    }
}

// Download table as image
downloadBtn.addEventListener('click', ()=>{
    html2canvas(tableWrapper,{scale:2}).then(canvas=>{
        const link=document.createElement('a');
        link.download='AWOL_Late_Monitoring.png';
        link.href=canvas.toDataURL();
        link.click();
        tableBody.innerHTML=''; // reset visible table
        updateStats();
    });
});

// View modal for saved data
viewDataBtn.addEventListener('click', ()=>{
    renderModalData();
    modal.style.display='block';
});

// Render saved data modal
function renderModalData(){
    modalTableBody.innerHTML='';
    records.forEach((record,index)=>{
        const row=document.createElement('tr');
        row.className=record.status.toLowerCase();
        row.innerHTML=`
            <td>${record.name}</td>
            <td>${record.status}</td>
            <td>${record.date}</td>
            <td>${record.comment || ''}</td>
            <td><button class="deleteRecordBtn" data-index="${index}" style="background:#dc3545;color:white;padding:5px 8px;border:none;border-radius:4px;cursor:pointer;">Delete</button></td>`;
        modalTableBody.appendChild(row);
    });
    document.querySelectorAll('.deleteRecordBtn').forEach(btn=>{
        btn.addEventListener('click',e=>{
            const idx=e.target.dataset.index;
            if(confirm("Delete this saved record?")){
                records.splice(idx,1);
                localStorage.setItem('attendanceRecords',JSON.stringify(records));
                renderModalData();
            }
        });
    });
}

// Clear all saved data
clearAllBtn.addEventListener('click', ()=>{
    if(confirm("Delete ALL saved data?")){
        records=[];
        localStorage.removeItem('attendanceRecords');
        renderModalData();
    }
});

// Close modal
modalClose.addEventListener('click', ()=>modal.style.display='none');
window.addEventListener('click', e=>{if(e.target==modal) modal.style.display='none';});

renderTable();
</script>
</body>
</html>
